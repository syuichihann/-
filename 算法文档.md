

**问题描述：**

构造一个数据结构，编码一个key-value pair的集合S，key value都是整数。支持给定key查询value，动态增删集合S的元素。要求数据结构空间占用尽量小，查询时间复杂度为常数。

**问题分析：**

最优空间占用即所有value占用的存储空间总和。

**算法分析：**

设编码n个key value pair。设value值域为$[0, D)$，如D=256。

数据结构使用m个变量，排成一个数组$A[i]$，每个变量值域为$[0, D)$，和value相同。

三个独立随机哈希函数$h_1(.), h_2(.), h_3(.)$ 把key映射为m个变量中的一个。

**算法思想**

维护方程$A[h_1(key)] \oplus A[h_2(key)] \oplus A[h_3(key)] = value$,$\oplus$ 代表亦或操作。

**算法流程：**

查询：三个哈希映射到的变量，计算亦或和，得到value。

插入方法：插入一个新的key value pair，为了满足方程限制，必须修改插入key映射到的任一变量，使得新方程成立。此外为了保持在此过程中被影响的方程成立，对于这些方程，必须在其剩余两个变量中选择一个进行进一步修改，如此迭代至所有方程都满足。



策略一：贪心选择被最少方程映射（限制）的变量

每次贪心选一个变量进行修改，使其影响最少的方程。

设存在待修改集合S={A[a]}，其中A[a]是插入的key映射的三个变量中影响最小（被最少方程映射）的那一个。

对于任意一个待修改集合中的变量，我们修改它时，还需要修改被其影响的所有方程，这样就会引入新的待修改变量，可能使得集合大小扩大。

接下来计算引入的新待修改的变量个数，如果其期望略小于1，那么能修改过程能很快停止，如果大于1，那么大概率无法停止，导致插入失败。

假设要修改A[a]，对于映射到它的其它方程来说，可能还映射到A[b], A[c]，要在b和c中选一个影响最小的进行进一步修改。考虑到a b c分别是独立哈希函数的映射值，b和c选择每个变量的概率是相等且独立的。

考虑球桶模型，把m个变量看成桶，3n个哈希映射看成球。那么要求b和c中最小的影响的大小（影响的方程个数），即是求解任意两个桶中球最少的桶的球数，可以近似为两个泊松分布的最小值的期望。

$\lambda=3n/m$

![image-20201226204657050](C:\Users\yuhan\AppData\Roaming\Typora\typora-user-images\image-20201226204657050.png)

![image-20201226204816279](C:\Users\yuhan\AppData\Roaming\Typora\typora-user-images\image-20201226204816279.png)

当m/n=1.76左右方程能快速更新，否则无法更新。



**离线解法：**

每次寻找只被一个方程限制的变量，压栈，删去该方程，迭代求解。在m/n=1.23左右可解。













































**其它一些没有写完的东西：**

策略2：

策略1分析实际上只看了一步，只查看“两个变量b c”被方程映射的次数，就贪心选了最小。实际上可以考虑对那些映射到“b和c”的方程进行多一步的影响计算，而非仅仅统计方程个数进行比较。

令$X_{min}$表示从一个变量代修改开始，迭代两步后，需要修改变量个数的分布。

$E(X_{min})=\sum\limits_{k\ge1}P(X_{min}\ge k)=$

设变量a导致b、c中的一个要被修改，b c分别导致tb tc个方程要被修改。

$\sum\limits_{k\ge1}P(X_{min}\ge k)=\sum\limits_{k\ge1}P(X_{b}\ge k)^2$，其中$X_b$表示：修改b后，导致tb个方程被修改，这些方程修改时贪心选方程个数最小的变量进行修改，$X_b$表示修改变量（末端方程）的个数。

$P(X_{b}\ge k)=\sum\limits_{tb=0}^{inf}P[TB=tb]*P[X_b\ge k|TB=tb]$

$P[X_b= k|TB=tb]=$

![image-20201227135050079](C:\Users\yuhan\AppData\Roaming\Typora\typora-user-images\image-20201227135050079.png)